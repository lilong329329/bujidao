import{_ as a,W as e,X as p,Z as s,$ as o,a0 as t,Y as r,D as l}from"./framework-4b7e9ff4.js";const c={},k=r(`<h1 id="mysql设置-密码策略" tabindex="-1"><a class="header-anchor" href="#mysql设置-密码策略" aria-hidden="true">#</a> MySQL设置 - 密码策略</h1><h2 id="_1-简介" tabindex="-1"><a class="header-anchor" href="#_1-简介" aria-hidden="true">#</a> 1. 简介</h2><p>在等保测评中，评测机构会要求设置密码安全测。如密码复杂度和自动过期策略等</p><h2 id="_2-密码复杂度策略设置" tabindex="-1"><a class="header-anchor" href="#_2-密码复杂度策略设置" aria-hidden="true">#</a> 2. 密码复杂度策略设置</h2><p>MySQL 系统自带有 validate_password 插件，此插件可以验证密码强度，未达到规定强度的密码则不允许被设置。MySQL 5.7 及 8.0 版本默认情况下貌似都不启用该插件，这也使得我们可以随意设置密码，比如设置为 123、123456等。如果我们想从根源上规范密码强度，可以启用该插件，下面一起来看下如何通过此插件来设置密码复杂度策略。</p><h3 id="_2-1-查看是否已安装此插件" tabindex="-1"><a class="header-anchor" href="#_2-1-查看是否已安装此插件" aria-hidden="true">#</a> <strong>2.1 查看是否已安装此插件</strong></h3><p>进入 MySQL 命令行，通过 show plugins 或者查看 validate_password 相关参数可以判断是否已安装此插件。若没有相关参数则代表未安装此插件</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 安装前检查 为空则说明未安装此插件</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;validate%&#39;</span><span class="token punctuation">;</span>
Empty <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-安装-validate-password-插件" tabindex="-1"><a class="header-anchor" href="#_2-2-安装-validate-password-插件" aria-hidden="true">#</a> 2.2 <strong>安装 validate_password 插件</strong></h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 通过 INSTALL PLUGIN 命令可安装此插件</span>
<span class="token comment"># 每个平台的文件名后缀都不同 对于 Unix 和类 Unix 系统，为.so，对于 Windows 为.dll</span>
mysql<span class="token operator">&gt;</span> INSTALL PLUGIN validate_password <span class="token keyword">SONAME</span> <span class="token string">&#39;validate_password.so&#39;</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected<span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.28</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 查看 validate_password 相关参数</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;validate%&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
<span class="token operator">|</span> Variable_name                        <span class="token operator">|</span> <span class="token keyword">Value</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
<span class="token operator">|</span> validate_password_check_user_name    <span class="token operator">|</span> <span class="token keyword">ON</span>     <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_dictionary_file    <span class="token operator">|</span>        <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_length             <span class="token operator">|</span> <span class="token number">8</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_mixed_case_count   <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_number_count       <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_policy             <span class="token operator">|</span> MEDIUM <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_special_char_count <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
<span class="token number">7</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.3 密码强度相关参数解释</strong></p><p>安装 validate_password 插件后，多了一些密码强度相关参数，这些参数从字面意思上也很容易看懂，下面简单解释下几个重点参数。</p><blockquote><p>1、validate_password_policy 代表的密码策略，默认是MEDIUM 可配置的值有以下： 0 or LOW 仅需需符合密码长度（由参数validate_password_length指定） 1 or MEDIUM 满足LOW策略，同时还需满足至少有1个数字，小写字母，大写字母和特殊字符 2 or STRONG 满足MEDIUM策略，同时密码不能存在字典文件（dictionary file）中</p><p>2、validate_password_dictionary_file 用于配置密码的字典文件，当validate_password_policy设置为STRONG时可以配置密码字典文件，字典文件中存在的密码不得使用。</p><p>3、validate_password_length 用来设置密码的最小长度，默认值是8</p><p>4、validate_password_mixed_case_count 当validate_password_policy设置为MEDIUM或者STRONG时，密码中至少同时拥有的小写和大写字母的数量，默认是1最小是0；默认是至少拥有一个小写和一个大写字母。</p><p>5、validate_password_number_count 当validate_password_policy设置为MEDIUM或者STRONG时，密码中至少拥有的数字的个数，默认1最小是0</p><p>6、validate_password_special_char_count 当validate_password_policy设置为MEDIUM或者STRONG时，密码中至少拥有的特殊字符的个数，默认1最小是0</p></blockquote><h3 id="_2-4-密码复杂度策略具体设置" tabindex="-1"><a class="header-anchor" href="#_2-4-密码复杂度策略具体设置" aria-hidden="true">#</a> 2.4 密码复杂度策略具体设置</h3><p>学习完以上参数，我们就可以根据自身情况来具体设置密码复杂度策略了，比如我想让密码至少 10 位且包含大小写字母、数字、特殊字符，则可以这样设置。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 设置密码长度至少10位</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> validate_password_length <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;validate%&#39;</span><span class="token punctuation">;</span>                                                                                   
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
<span class="token operator">|</span> Variable_name                        <span class="token operator">|</span> <span class="token keyword">Value</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
<span class="token operator">|</span> validate_password_check_user_name    <span class="token operator">|</span> <span class="token keyword">ON</span>     <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_dictionary_file    <span class="token operator">|</span>        <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_length             <span class="token operator">|</span> <span class="token number">10</span>     <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_mixed_case_count   <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_number_count       <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_policy             <span class="token operator">|</span> MEDIUM <span class="token operator">|</span>
<span class="token operator">|</span> validate_password_special_char_count <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
<span class="token number">7</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 若想永久生效，建议将以下参数写入配置文件</span>
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
plugin<span class="token operator">-</span><span class="token keyword">load</span> <span class="token operator">=</span> validate_password<span class="token punctuation">.</span>so
validate_password_length <span class="token operator">=</span> <span class="token number">10</span>
validate_password_policy <span class="token operator">=</span> <span class="token number">1</span>
validate<span class="token operator">-</span>password <span class="token operator">=</span> FORCE_PLUS_PERMANENT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-测试密码复杂度" tabindex="-1"><a class="header-anchor" href="#_2-5-测试密码复杂度" aria-hidden="true">#</a> 2.5 测试密码复杂度</h3><p>密码复杂度策略只对生效后的操作有效，比如说你之前有个账号，密码是 123 ，则该账号还是可以继续使用的，不过若再次更改密码则需满足复杂度策略。下面我们来测试下密码复杂度策略的具体效果。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 新建用户设置密码</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">&#39;testuser&#39;</span><span class="token variable">@&#39;%&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;123&#39;</span><span class="token punctuation">;</span>
ERROR <span class="token number">1819</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Your password does <span class="token operator">not</span> satisfy the <span class="token keyword">current</span> policy requirements
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">&#39;testuser&#39;</span><span class="token variable">@&#39;%&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;ab123&#39;</span><span class="token punctuation">;</span>
ERROR <span class="token number">1819</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Your password does <span class="token operator">not</span> satisfy the <span class="token keyword">current</span> policy requirements
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">&#39;testuser&#39;</span><span class="token variable">@&#39;%&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;Ab@123&#39;</span><span class="token punctuation">;</span>
ERROR <span class="token number">1819</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Your password does <span class="token operator">not</span> satisfy the <span class="token keyword">current</span> policy requirements
mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">&#39;testuser&#39;</span><span class="token variable">@&#39;%&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;Bsdf@5467672&#39;</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 更改密码</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">&#39;testuser&#39;</span><span class="token variable">@&#39;%&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;dfgf3435&#39;</span><span class="token punctuation">;</span>
ERROR <span class="token number">1819</span> <span class="token punctuation">(</span>HY000<span class="token punctuation">)</span>: Your password does <span class="token operator">not</span> satisfy the <span class="token keyword">current</span> policy requirements
mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">&#39;testuser&#39;</span><span class="token variable">@&#39;%&#39;</span> identified <span class="token keyword">by</span> <span class="token string">&#39;dBsdf@5467672&#39;</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-设置密码自动过期" tabindex="-1"><a class="header-anchor" href="#_3-设置密码自动过期" aria-hidden="true">#</a> 3. 设置密码自动过期</h2><p>除了设置密码复杂度策略外，我们还可以设置密码自动过期，比如说隔 90 天密码会过期必须修改密码后才能继续使用，这样我们的数据库账号就更加安全了。下面我们来看下如何设置密码自动过期。</p><h3 id="_3-1-单独设置某个账号密码过期时间" tabindex="-1"><a class="header-anchor" href="#_3-1-单独设置某个账号密码过期时间" aria-hidden="true">#</a> 3.1 <strong>单独设置某个账号密码过期时间</strong></h3><p>使用 ALTER USER 语句可以使单个账号密码过期，也可以更改账号过期时间。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 通过 mysql.user 系统表查看数据库账号状态</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">,</span>host<span class="token punctuation">,</span>password_expired<span class="token punctuation">,</span>password_lifetime<span class="token punctuation">,</span>password_last_changed<span class="token punctuation">,</span>account_locked <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+------------------+-------------------+-----------------------+----------------+</span>
<span class="token operator">|</span> <span class="token keyword">user</span>             <span class="token operator">|</span> host      <span class="token operator">|</span> password_expired <span class="token operator">|</span> password_lifetime <span class="token operator">|</span> password_last_changed <span class="token operator">|</span> account_locked <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+------------------+-------------------+-----------------------+----------------+</span>
<span class="token operator">|</span> expuser          <span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">14</span>:<span class="token number">30</span>:<span class="token number">30</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">45</span>:<span class="token number">43</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">|</span> testuser         <span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">17</span>:<span class="token number">22</span>:<span class="token number">37</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span>infoschema <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">37</span>:<span class="token number">09</span>   <span class="token operator">|</span> Y              <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span><span class="token keyword">session</span>    <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">37</span>:<span class="token number">09</span>   <span class="token operator">|</span> Y              <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span>sys        <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">37</span>:<span class="token number">09</span>   <span class="token operator">|</span> Y              <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">38</span>:<span class="token number">55</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+------------------+-------------------+-----------------------+----------------+</span>
<span class="token number">7</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 使 expuser 账号密码立即过期</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">&#39;expuser&#39;</span><span class="token variable">@&#39;%&#39;</span> PASSWORD EXPIRE<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">,</span>host<span class="token punctuation">,</span>password_expired<span class="token punctuation">,</span>password_lifetime<span class="token punctuation">,</span>password_last_changed<span class="token punctuation">,</span>account_locked <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+------------------+-------------------+-----------------------+----------------+</span>
<span class="token operator">|</span> <span class="token keyword">user</span>             <span class="token operator">|</span> host      <span class="token operator">|</span> password_expired <span class="token operator">|</span> password_lifetime <span class="token operator">|</span> password_last_changed <span class="token operator">|</span> account_locked <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+------------------+-------------------+-----------------------+----------------+</span>
<span class="token operator">|</span> expuser          <span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span> Y                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">14</span>:<span class="token number">30</span>:<span class="token number">30</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">45</span>:<span class="token number">43</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">|</span> testuser         <span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">17</span>:<span class="token number">22</span>:<span class="token number">37</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span>infoschema <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">37</span>:<span class="token number">09</span>   <span class="token operator">|</span> Y              <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span><span class="token keyword">session</span>    <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">37</span>:<span class="token number">09</span>   <span class="token operator">|</span> Y              <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span>sys        <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">37</span>:<span class="token number">09</span>   <span class="token operator">|</span> Y              <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">38</span>:<span class="token number">55</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+------------------+-------------------+-----------------------+----------------+</span>
<span class="token number">7</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 修改账号密码永不过期</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">&#39;expuser&#39;</span><span class="token variable">@&#39;%&#39;</span> PASSWORD EXPIRE NEVER<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 单独设置该账号密码90天过期</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">&#39;expuser&#39;</span><span class="token variable">@&#39;%&#39;</span> PASSWORD EXPIRE <span class="token keyword">INTERVAL</span> <span class="token number">90</span> <span class="token keyword">DAY</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">,</span>host<span class="token punctuation">,</span>password_expired<span class="token punctuation">,</span>password_lifetime<span class="token punctuation">,</span>password_last_changed<span class="token punctuation">,</span>account_locked <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+------------------+-------------------+-----------------------+----------------+</span>
<span class="token operator">|</span> <span class="token keyword">user</span>             <span class="token operator">|</span> host      <span class="token operator">|</span> password_expired <span class="token operator">|</span> password_lifetime <span class="token operator">|</span> password_last_changed <span class="token operator">|</span> account_locked <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+------------------+-------------------+-----------------------+----------------+</span>
<span class="token operator">|</span> expuser          <span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span> N                <span class="token operator">|</span>                <span class="token number">90</span> <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">14</span>:<span class="token number">41</span>:<span class="token number">28</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">45</span>:<span class="token number">43</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">|</span> testuser         <span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">17</span>:<span class="token number">22</span>:<span class="token number">37</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span>infoschema <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">37</span>:<span class="token number">09</span>   <span class="token operator">|</span> Y              <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span><span class="token keyword">session</span>    <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">37</span>:<span class="token number">09</span>   <span class="token operator">|</span> Y              <span class="token operator">|</span>
<span class="token operator">|</span> mysql<span class="token punctuation">.</span>sys        <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">37</span>:<span class="token number">09</span>   <span class="token operator">|</span> Y              <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span> localhost <span class="token operator">|</span> N                <span class="token operator">|</span>              <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">14</span>:<span class="token number">38</span>:<span class="token number">55</span>   <span class="token operator">|</span> N              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+-----------+------------------+-------------------+-----------------------+----------------+</span>
<span class="token number">7</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 让此账号使用默认的密码过期全局策略</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">&#39;expuser&#39;</span><span class="token variable">@&#39;%&#39;</span> PASSWORD EXPIRE <span class="token keyword">DEFAULT</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>mysql.user 系统表记录着每个账号的相关信息，当 password_expired 字段值为 Y 时，代表此密码已过期，使用过期密码仍可以登录，但不能进行任何操作，进行操作会提示：ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement. 必须更改密码后才能进行正常操作。</p><p>对于给定过期时间的账号，比如说设置 90 天过期，数据库系统会比较当前时间与上次修改密码的时间差值，如果距离上次修改密码时间超过 90 天，则将此账号密码标记为过期，必须更改密码后才能进行操作。</p><h3 id="_3-2-设置全局过期策略" tabindex="-1"><a class="header-anchor" href="#_3-2-设置全局过期策略" aria-hidden="true">#</a> 3.2 <strong>设置全局过期策略</strong></h3><p>要构建全局密码自动过期策略，请使用 default_password_lifetime 系统变量。在 5.7.11 版本之前，默认的 default_password_lifetime 值为 360(密码大约每年必须更改一次)，之后的版本默认值为 0，表示密码不会过期。此参数的单位是天，比如我们可以将此参数设置为 90 ，则表示全局密码自动过期策略是 90 天。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 设置全局过期策略 先手动更改再加入配置文件</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> default_password_lifetime <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&#39;default_password_lifetime&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------+-------+</span>
<span class="token operator">|</span> Variable_name             <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+-------+</span>
<span class="token operator">|</span> default_password_lifetime <span class="token operator">|</span> <span class="token number">90</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 写入配置文件使得重启生效</span>
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
default_password_lifetime <span class="token operator">=</span> <span class="token number">90</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>尽管可以通过将过期的密码设置为当前值来“重置”它，但出于良好的 Policy 考虑，最好选择其他密码。</p><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2>`,31),i={href:"https://www.cnblogs.com/mysqljs/p/14246130.html",target:"_blank",rel:"noopener noreferrer"};function d(u,m){const n=l("ExternalLinkIcon");return e(),p("div",null,[k,s("p",null,[s("a",i,[o("MySQL密码复杂度与密码过期策略介绍 "),t(n)])])])}const v=a(c,[["render",d],["__file","mysql-x-setting-password-policy.html.vue"]]);export{v as default};
